# CodeIgniter 4 - C4 Level 4: RouteCollection

**Generated:** 2025-10-15 05:09:06  
**Type:** Handler  
**File:** `system/Router/RouteCollection.php`

---

## Component Overview

### Purpose
Manages the collection and organization of application routes, including adding, grouping, and matching routes based on HTTP verbs and patterns. It serves as the central registry for routing definitions in CodeIgniter 4's MVC architecture.

### Responsibility
Collects, validates, and organizes route definitions from various sources, providing a structured way to map URIs to controller handlers while supporting advanced features like route grouping, resources, and redirects.

### Design Patterns
- Collection
- Registry

---

## Public Interface

```php
public addPlaceholder()
public setDefaultNamespace()
public add()
public addRedirect()
public group()
public get()
public post()
public resource()
public presenter()
public getRoutes()
public get404Override()
public setHTTPVerb()
public map()
public loadRoutes()
```

---

## Key Methods

### `loadRoutes()`

**Purpose:** Loads and discovers route definitions from specified files and modules.

**Parameters:** `string $routesFile = APPPATH . 'Config/Routes.php'`

**Returns:** `RouteCollectionInterface ($this)`

**Complexity:** Moderate

### `add()`

**Purpose:** Adds a single route to the collection for any HTTP verb.

**Parameters:** `string $from, array|Closure|string $to, ?array $options = null`

**Returns:** `RouteCollectionInterface ($this)`

**Complexity:** Simple

### `getRoutes()`

**Purpose:** Retrieves all routes for a specific HTTP verb, including options for wildcards and prioritization.

**Parameters:** `?string $verb = null, bool $includeWildcard = true`

**Returns:** `array`

**Complexity:** Moderate

### `group()`

**Purpose:** Groups routes under a common prefix, applying options and allowing nested definitions.

**Parameters:** `string $name, ...$params (including callback)`

**Returns:** `void`

**Complexity:** Complex

### `resource()`

**Purpose:** Generates a full set of RESTful routes for a controller based on resource naming conventions.

**Parameters:** `string $name, ?array $options = null`

**Returns:** `RouteCollectionInterface ($this)`

**Complexity:** Complex

---

## Dependencies

```mermaid
classDiagram
    class RouteCollection
    RouteCollectionInterface <|.. RouteCollection
    RouteCollection ..> FileLocatorInterface
    RouteCollection ..> Modules
    RouteCollection ..> Routing
    RouteCollection ..> CodeIgniter\HTTP\Method
```

**Dependency Details:**

- **RouteCollectionInterface** (interface) - implements
- **FileLocatorInterface** (interface) - injects
- **Modules** (class) - injects
- **Routing** (class) - injects
- **CodeIgniter\HTTP\Method** (class) - uses

---

## Internal State

- `$routes: array - Multidimensional array storing routes by HTTP verb with keys for routeKey, name, handler, etc.`
- `$routesNames: array - Maps route names to their corresponding keys for each verb.`
- `$placeholders: array<string, string> - Associative array of predefined regex patterns for route placeholders.`
- `$defaultNamespace: string - Default namespace prefix for controllers.`
- `$HTTPVerb: string - Current HTTP verb being processed.`
- `$group: string|null - Current group prefix for routes.`
- `$currentOptions: array|null - Options applied to current route group.`

---

## Key Algorithms

### Route Discovery

Automatically loads route files from the application and discovered modules, ensuring modular routing while avoiding duplicates and maintaining loading order.

### Route Prioritization

Sorts routes based on priority options to control matching order, critical for overriding generic routes with specific ones.


---

## Integration Points

- Router class for route matching and dispatch
- Controller classes as route handlers
- Modules config for automatic route discovery
- FileLocator for locating route files in PSR4 namespaces

---

## Architectural Notes

RouteCollection acts as a singleton-like registry for routes, enabling fluent API for route definition. It supports HTTP verb segregation for security and RESTful design, with grouping and resource methods reducing boilerplate. The class isolates route management from matching logic, allowing for efficient lookup and extensibility through placeholders and modules.

---

*Generated by Flowscribe - Automated C4 Architecture Documentation*
